<template>
  <div class='flex-column ui-color-dark ui-fullscreen'>
    <nav class='flex-row flex-fixed' style='flex-wrap: wrap'>
      <shortcut title="Actions" icon="menu" data-push-overlay="menu-overlay"></shortcut>
      <shortcut title="Channels" icon="earth" data-push-overlay="channel-select-overlay"></shortcut>
      <shortcut title="Users" icon="heart" data-push-overlay="online-users-overlay"></shortcut>

      <chat-tab v-for="chat in activeChats"
        :active="$index === currentIndex"
        @selected="currentIndex = $index"
        @closed="closeChat(chat)">
        {{chat.name}}
      </chat-tab>
    </nav>

    <channel-view v-if="currentChat && currentChat.type === 'channel'"
      :messages="currentChat.message"
      :characters="currentChat.characters"
      :description="currentChat.description">
      <chatbox slot='chatbox'
        @chatbox-submit="chatboxSubmit">
      </chatbox>
    </channel-view>
  </div>
</template>

<style lang="stylus" scoped>
.header-shortcut
  width: 2em
  height: @width
</style>

<script>
import ChatTab from './ChatTab.vue'
import Chatbox from './Chatbox.vue'
import ChannelView from './ChannelView.vue'
// import PrivateChatView from './PrivateChatView.vue'
// import {pushOverlay} from '../modules/vuex/actions'

// function clamp (num, min, max) {
//   return num < min ? min
//     : num > max ? max
//     : num
// }

const Shortcut = {
  template: `
    <a href='#' class='flex-fixed flex-center-children header-shortcut'
      title="Actions">
      <i :class="'mdi mdi-' + icon" style="pointer-events: none"></i>
    </a>
  `,

  props: {
    icon: String,
    overlay: String
  }
}

export default {
  components: {
    ChatTab,
    ChannelView,
    Chatbox,
    // PrivateChatView,
    Shortcut
  },

  data () {
    return {
      currentIndex: 0
    }
  },

  methods: {
    closeChat (chat) {
      // if (chat.type === 'channel') {
      //   store.notify('LeaveChannelRequest', { id: chat.id })
      //   this.currentIndex--
      // }
    },

    chatboxSubmit (message) {
      console.info(message)
    }
  },

  watch: {
    // activeChats () {
    //   this.currentIndex = clamp(this.currentIndex, 0, this.activeChats.length - 1)
    // }
  }
}
</script>

<style lang="stylus" scoped>
/*@import '../styles/mixins'

.app-menu-button
  size: 2em*/
</style>
