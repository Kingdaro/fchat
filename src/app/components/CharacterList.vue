<template>
  <form class='character-list' @submit.prevent='submit'>
    <fieldset>
      <h2>Select a Character</h2>
    </fieldset>
    <fieldset>
      <div class='character-list-avatar' :style="{ 'background-image': 'url(' + avatarURL + ')' }"></div>
    </fieldset>
    <fieldset>
      <div class='form-selection-list'>
        <a href='#' v-for='name in characters' :class="name === current && 'active'"
          @click.prevent='select(name)' @focus='select(name)'>
          {{ name }}
        </a>
      </div>
    </fieldset>
    <fieldset>
      <button class='form-button' action='submit'>Go</button>
    </fieldset>
  </form>
</template>

<script>
import {getAvatarURL} from '../lib/f-list'
import {store, getters} from '../store'
import * as storage from 'localforage'

export default {
  data() {
    return {
      current: '',
    }
  },
  mounted() {
    storage.getItem('character').then(value => {
      if (value) this.current = value
    })
  },
  methods: {
    select(name) {
      this.current = name
      storage.setItem('character', name)
    },
    submit() {
      store.chooseCharacter(this.current)
    },
  },
  computed: {
    ...getters({
      characters: 'userCharacters',
    }),
    avatarURL() {
      return this.current && getAvatarURL(this.current)
    },
  },
}
</script>

<style lang='stylus' scoped>
@require 'form'
@require 'layout'

.character-list
  text-align: center

.character-list-avatar
  size(100px)
  margin: 0.3em
  display: inline-block
  filter: drop-shadow(0px 2px 4px rgba(black, 0.5))

.form-selection-list
  width: 12em
</style>
